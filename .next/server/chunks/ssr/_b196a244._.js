module.exports=[88442,a=>{a.v({"btn-primary":"checkout-module__r7yD0G__btn-primary","btn-secondary":"checkout-module__r7yD0G__btn-secondary","checkout-page":"checkout-module__r7yD0G__checkout-page","close-modal-btn":"checkout-module__r7yD0G__close-modal-btn","detailed-address-textarea":"checkout-module__r7yD0G__detailed-address-textarea","error-input":"checkout-module__r7yD0G__error-input","error-text":"checkout-module__r7yD0G__error-text",fadeIn:"checkout-module__r7yD0G__fadeIn","gov-dropdown":"checkout-module__r7yD0G__gov-dropdown","gov-option":"checkout-module__r7yD0G__gov-option","gov-search-input":"checkout-module__r7yD0G__gov-search-input","gov-select-wrapper":"checkout-module__r7yD0G__gov-select-wrapper","inputs-grid":"checkout-module__r7yD0G__inputs-grid","modal-actions":"checkout-module__r7yD0G__modal-actions","modal-content":"checkout-module__r7yD0G__modal-content","modal-header":"checkout-module__r7yD0G__modal-header","modal-overlay":"checkout-module__r7yD0G__modal-overlay","modal-title":"checkout-module__r7yD0G__modal-title","notification-error":"checkout-module__r7yD0G__notification-error","notification-success":"checkout-module__r7yD0G__notification-success","notification-toast":"checkout-module__r7yD0G__notification-toast","payment-box":"checkout-module__r7yD0G__payment-box","place-order-btn":"checkout-module__r7yD0G__place-order-btn",scaleUp:"checkout-module__r7yD0G__scaleUp",section:"checkout-module__r7yD0G__section","section-title":"checkout-module__r7yD0G__section-title",slideIn:"checkout-module__r7yD0G__slideIn","summary-item":"checkout-module__r7yD0G__summary-item","summary-total":"checkout-module__r7yD0G__summary-total",title:"checkout-module__r7yD0G__title"})},83697,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(27544),e=a.i(50944),f=a.i(67836),g=a.i(88442);let h=["Cairo","Giza","Alexandria","Dakahlia","Sharqia","Qalyubia","Kafr El Sheikh","Gharbia","Monufia","Beheira","Ismailia","Port Said","Suez","North Sinai","South Sinai","Damietta","New Valley","Matruh","Qena","Sohag","Aswan","Luxor","Red Sea","Beni Suef","Faiyum","Minya","Asyut"];function i(){let a=(0,e.useRouter)(),[i,j]=(0,c.useState)({fullName:"",email:"",phone:"",city:"",government:"",detailedAddress:""}),[k,l]=(0,c.useState)(0),[m,n]=(0,c.useState)("will be determined in the next step"),[o,p]=(0,c.useState)({}),[q,r]=(0,c.useState)(null),{user:s,loading:t,cartItems:u,refreshCart:v}=(0,f.useUser)(),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(0),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),G=(0,c.useRef)(null),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(!1),L=(0,c.useRef)(null),M=a=>{if(!a){l(0),n("");return}let b=a.toLowerCase().trim();"cairo"===b||"giza"===b?(l(50),n("")):"qalyubia"===b||"qalubia"===b?(l(75),n("")):""===b?(l(0),n("will be determined in the next step")):(l(0),n("Arrange via external courier"))},N=a=>{let{name:b,value:c}=a.target;j(a=>({...a,[b]:c}))},O=(a,b)=>{r({type:a,message:b}),setTimeout(()=>r(null),4e3)},P=async()=>{let b;if(b={},i.fullName.trim()||(b.fullName="Full Name is required"),i.email.trim()||(b.email="Email is required"),i.phone.trim()||(b.phone="Phone Number is required"),i.city.trim()||(b.city="City is required"),i.government.trim()||(b.government="Governorate is required"),i.detailedAddress.trim()||(b.detailedAddress="Address is required"),p(b),0!==Object.keys(b).length)return void O("error","Please fill in all details correctly.");D(!0);try{if(0===u.length){O("error","Your cart is empty."),D(!1);return}let b=u.reduce((a,b)=>a+b.salePrice*b.quantity,0)+k,c={name:i.fullName,email:i.email,phone:i.phone,items:u.map(a=>({productId:a.productId,quantity:a.quantity,color:a.color,size:a.size})),totalPrice:b,paymentMethod:"Cash on Delivery",paymentStatus:"unpaid",orderStatus:"pending",address:`${i.detailedAddress}, ${i.city}, ${i.government}`},e=await fetch(d.END_POINT.ORDERS,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)}),f=await e.json();if(e.ok&&f.successful){let b=G.current;if(b&&(b.phone!==i.phone||b.address!==i.detailedAddress||b.name!==i.fullName)){let a={name:i.fullName,phone:i.phone,address:i.detailedAddress};try{(await fetch(`${d.END_POINT.USERS}/profile`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)})).ok||console.warn("Profile update failed, but order was placed successfully")}catch(a){console.warn("Profile update error:",a)}}await fetch(d.END_POINT.CART(""),{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"}),v(),F(!1),O("success","Order placed successfully! Redirecting..."),setTimeout(()=>{a.push("/")},1500)}else O("error",f.message||"Failed to place order. Please try again."),D(!1)}catch(a){console.error("Error placing order:",a),O("error","An error occurred. Please try again."),D(!1)}},Q=h.filter(a=>a.toLowerCase().includes(H.toLowerCase()));(0,c.useEffect)(()=>{if(!t&&!s)return void a.replace("/auth/login");if(s){let a=s.government||"";j(b=>({...b,fullName:s.name||"",email:s.email||"",phone:s.phone||"",government:a,city:s.city||"",detailedAddress:s.address||""})),G.current=s,I(a),M(a),B(!1)}},[s,t,a]),(0,c.useEffect)(()=>{u&&(x(u),z(u.reduce((a,b)=>a+b.salePrice*b.quantity,0)))},[u]),(0,c.useEffect)(()=>{let a=a=>{L.current&&!L.current.contains(a.target)&&K(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]);let R=m?y:y+k;return(0,b.jsxs)("div",{className:g.default["checkout-page"],children:[(0,b.jsx)("h1",{className:g.default.title,children:"Checkout"}),q&&(0,b.jsx)("div",{className:`${g.default["notification-toast"]} ${"success"===q.type?g.default["notification-success"]:g.default["notification-error"]}`,children:q.message}),(0,b.jsxs)("section",{className:g.default.section,children:[(0,b.jsx)("h2",{className:g.default["section-title"],children:"Contact Info"}),(0,b.jsx)("div",{className:g.default["inputs-grid"],children:(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:i.phone,onChange:N,className:o.phone?g.default["error-input"]:""}),o.phone&&(0,b.jsx)("small",{className:g.default["error-text"],children:o.phone})]})})]}),(i.government||i.city||i.detailedAddress)&&(0,b.jsxs)("section",{className:g.default.section,children:[(0,b.jsx)("h2",{className:g.default["section-title"],children:"Shipping To"}),(0,b.jsxs)("div",{style:{padding:"10px 0",fontSize:"16px",color:"#555"},children:[(0,b.jsxs)("p",{style:{margin:"0 0 5px"},children:[(0,b.jsx)("strong",{children:i.government}),i.city?`, ${i.city}`:""]}),(0,b.jsx)("p",{style:{margin:0},children:i.detailedAddress})]})]}),(0,b.jsxs)("section",{className:g.default.section,children:[(0,b.jsx)("h2",{className:g.default["section-title"],children:"Payment Method"}),(0,b.jsx)("div",{className:g.default["payment-box"],children:(0,b.jsxs)("label",{children:[(0,b.jsx)("input",{type:"radio",name:"payment",defaultChecked:!0,readOnly:!0}),"Cash on Delivery"]})})]}),(0,b.jsxs)("section",{className:`${g.default.section} ${g.default.summary}`,children:[(0,b.jsx)("h2",{className:g.default["section-title"],children:"Order Summary"}),(0,b.jsx)("div",{style:{marginBottom:"20px",borderBottom:"1px solid #f0f0f0",paddingBottom:"10px"},children:w.map(a=>(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"15px",color:"#555"},children:[(0,b.jsxs)("span",{children:[a.name," x ",a.quantity]}),(0,b.jsxs)("span",{children:[(a.salePrice*a.quantity).toFixed(2)," EGP"]})]},a.id))}),(0,b.jsxs)("div",{className:g.default["summary-item"],children:[(0,b.jsx)("span",{children:"Subtotal"}),(0,b.jsxs)("span",{children:[y.toFixed(2)," EGP"]})]}),(0,b.jsxs)("div",{className:g.default["summary-item"],children:[(0,b.jsx)("span",{children:"Shipping"}),(0,b.jsx)("span",{style:{fontSize:m?"14px":"18px",color:m?"#e67e22":"inherit"},children:m||`${k.toFixed(2)} EGY`})]}),(0,b.jsxs)("div",{className:g.default["summary-total"],children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsxs)("span",{children:[R.toFixed(2)," EGP"]})]})]}),(0,b.jsx)("button",{className:g.default["place-order-btn"],onClick:a=>{a.preventDefault(),(i.phone.trim()?(p({}),0):(p({phone:"Phone Number is required"}),1))||F(!0)},disabled:A,children:A?"Loading...":"Checkout"}),E&&(0,b.jsx)("div",{className:g.default["modal-overlay"],children:(0,b.jsxs)("div",{className:g.default["modal-content"],children:[(0,b.jsxs)("div",{className:g.default["modal-header"],children:[(0,b.jsx)("h3",{className:g.default["modal-title"],children:"Confirm Your Details"}),(0,b.jsx)("button",{className:g.default["close-modal-btn"],onClick:()=>F(!1),children:"Ã—"})]}),(0,b.jsx)("p",{style:{marginBottom:"20px",color:"#666"},children:"Please review your information before placing the order."}),(0,b.jsxs)("div",{className:g.default["inputs-grid"],style:{gap:"15px"},children:[(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"text",name:"fullName",placeholder:"Full Name",value:i.fullName,onChange:N,className:o.fullName?g.default["error-input"]:""}),o.fullName&&(0,b.jsx)("small",{className:g.default["error-text"],children:o.fullName})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"email",name:"email",placeholder:"Email",value:i.email,className:o.email?g.default["error-input"]:"",disabled:!0}),o.email&&(0,b.jsx)("small",{className:g.default["error-text"],children:o.email})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:i.phone,onChange:N,className:o.phone?g.default["error-input"]:""}),o.phone&&(0,b.jsx)("small",{className:g.default["error-text"],children:o.phone})]}),(0,b.jsxs)("div",{className:g.default["gov-select-wrapper"],ref:L,children:[(0,b.jsx)("input",{type:"text",name:"government",placeholder:"Government",value:H,onChange:a=>{let b=a.target.value;I(b),K(!0),b&&h.includes(b)?(j(a=>({...a,government:b})),M(b)):b||(j(a=>({...a,government:""})),M(""))},onFocus:()=>K(!0),className:`${g.default["gov-search-input"]} ${o.government?g.default["error-input"]:""}`}),o.government&&(0,b.jsx)("small",{className:g.default["error-text"],children:o.government}),J&&Q.length>0&&(0,b.jsx)("div",{className:g.default["gov-dropdown"],children:Q.map(a=>(0,b.jsx)("div",{className:g.default["gov-option"],onClick:()=>{j(b=>({...b,government:a})),I(a),K(!1),M(a)},children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"text",name:"city",placeholder:"City",value:i.city,onChange:N,className:o.city?g.default["error-input"]:""}),o.city&&(0,b.jsx)("small",{className:g.default["error-text"],children:o.city})]}),(0,b.jsx)("textarea",{name:"detailedAddress",placeholder:"Detailed Address",value:i.detailedAddress,onChange:N,className:`${g.default["detailed-address-textarea"]} ${o.detailedAddress?g.default["error-input"]:""}`,style:{minHeight:"80px"}}),o.detailedAddress&&(0,b.jsx)("small",{className:g.default["error-text"],children:o.detailedAddress})]}),(0,b.jsxs)("div",{className:g.default.summary,style:{marginTop:"20px",background:"#fafafa",padding:"15px",borderRadius:"12px"},children:[(0,b.jsxs)("div",{className:`${g.default["summary-item"]} flex flex-col`,style:{fontSize:"16px"},children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Shipping:"}),(0,b.jsxs)("strong",{children:[k.toFixed(2)," EGP"]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Total with Shipping:"}),(0,b.jsxs)("strong",{children:[R.toFixed(2)," EGP"]})]})]}),m&&(0,b.jsx)("small",{style:{color:"#e67e22"},children:m})]}),(0,b.jsxs)("div",{className:g.default["modal-actions"],children:[(0,b.jsx)("button",{className:g.default["btn-secondary"],onClick:()=>F(!1),children:"Cancel"}),(0,b.jsx)("button",{className:g.default["btn-primary"],onClick:P,disabled:C,children:C?"Confirming...":"Save & Confirm Order"})]})]})})]})}a.s(["default",()=>i])}];

//# sourceMappingURL=_b196a244._.js.map