{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/VSCode/Web-dev/Front-end/Projects/threadix/frontend/app/checkout/cart/page.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { Minus, Plus, Trash2, X } from \"lucide-react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { API_BASE_URL, END_POINT } from \"@/config\";\r\nimport { useUser } from '@/context/UserContext';\r\nimport Link from \"next/link\";\r\nimport '@/styles/cart.css';\r\n\r\nexport default function CartPage() {\r\n\r\n  const router = useRouter();\r\n  const { cartItems: ctxCartItems, loading, refreshCart } = useUser();\r\n  const [cartItems, setCartItems] = useState([]);\r\n  const [subTotal, setSubTotal] = useState(0);\r\n  const [toast, setToast] = useState({ show: false, message: '', type: 'error' });\r\n\r\n  useEffect(() => {\r\n    if (ctxCartItems) {\r\n      setCartItems(ctxCartItems);\r\n    }\r\n  }, [ctxCartItems]);\r\n\r\n  const updateQtyOnServer = async (id, newQty) => {\r\n    try {\r\n      const res = await fetch(END_POINT.CART(`item/${id}`), {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ quantity: newQty }),\r\n        credentials: 'include',\r\n      });\r\n      const json = await res.json();\r\n      if (res.status === 401) {\r\n        router.replace('/auth/login');\r\n        return;\r\n      }\r\n      if (!json.successful) {\r\n        setToast({ show: true, message: json.msg || 'Failed to update quantity', type: 'error' });\r\n        return false;\r\n      }\r\n      refreshCart();\r\n      return true;\r\n    } catch (err) {\r\n      console.error(err.message);\r\n      setToast({ show: true, message: 'Connection error. Quantity not saved.', type: 'error' });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const increaseQty = async (id) => {\r\n    const item = cartItems.find(i => i.id === id);\r\n    if (!item) return;\r\n    const newQty = item.quantity + 1;\r\n\r\n    // Optimistic update\r\n    setCartItems(items => items.map(i => i.id === id ? { ...i, quantity: newQty } : i));\r\n\r\n    const success = await updateQtyOnServer(id, newQty);\r\n    if (!success) {\r\n      // Rollback\r\n      setCartItems(items => items.map(i => i.id === id ? { ...i, quantity: item.quantity } : i));\r\n    }\r\n  };\r\n\r\n  const decreaseQty = async (id) => {\r\n    const item = cartItems.find(i => i.id === id);\r\n    if (!item || item.quantity <= 1) return;\r\n    const newQty = item.quantity - 1;\r\n\r\n    // Optimistic update\r\n    setCartItems(items => items.map(i => i.id === id ? { ...i, quantity: newQty } : i));\r\n\r\n    const success = await updateQtyOnServer(id, newQty);\r\n    if (!success) {\r\n      // Rollback\r\n      setCartItems(items => items.map(i => i.id === id ? { ...i, quantity: item.quantity } : i));\r\n    }\r\n  };\r\n\r\n  const removeItem = async (id) => {\r\n    try {\r\n      const res = await fetch(END_POINT.CART(`item/${id}`), {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n      });\r\n      const json = await res.json();\r\n      if (res.status === 401) {\r\n        router.replace('/auth/login');\r\n        return;\r\n      }\r\n      if (json.successful) {\r\n        setCartItems((items) => items.filter((item) => item.id !== id));\r\n        refreshCart();\r\n      } else {\r\n        setToast({ show: true, message: json.msg || 'Failed to remove item', type: 'error' });\r\n      }\r\n    } catch (err) {\r\n      console.error(err.message);\r\n      setToast({ show: true, message: 'An error occurred while removing the item', type: 'error' });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const total = cartItems?.reduce(\r\n      (acc, item) => acc + (item.salePrice * item.quantity),\r\n      0\r\n    );\r\n    setSubTotal(total);\r\n  }, [cartItems]);\r\n\r\n  // Format item name with color and size in brackets\r\n  const formatItemName = (item) => {\r\n    const parts = [];\r\n    if (item.color) parts.push(item.color);\r\n    if (item.size) parts.push(item.size);\r\n    \r\n    if (parts.length > 0) {\r\n      return `${item.name} (${parts.join(', ')})`;\r\n    }\r\n    return item.name;\r\n  };\r\n\r\n  if (loading && cartItems?.length === 0) {\r\n    return (\r\n      <section className=\"cart-page flex items-center justify-center min-h-[400px]\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gray-900\"></div>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <section className=\"cart-page\">\r\n      <h1>Your Cart</h1>\r\n      { }\r\n      {cartItems?.length === 0 ? (\r\n        <div className=\"empty-cart\">\r\n          <p>Your cart is empty.</p>\r\n          <Link href=\"/shop\">Continue Shopping</Link>\r\n        </div>\r\n      ) : (\r\n        <div className=\"cart-layout\">\r\n          {/* Cart Items */}\r\n          <div className=\"cart-items\">\r\n            {cartItems?.length > 0 && cartItems?.map((item) => (\r\n              <div key={item.id} className=\"cart-item\">\r\n                <img\r\n                  className=\"rounded-md\"\r\n                  src={API_BASE_URL + item.image}\r\n                  alt={item.name}\r\n                  width={120}\r\n                  height={120}\r\n                />\r\n\r\n                <div className=\"item-info\">\r\n                  <h3>{formatItemName(item)}</h3>\r\n                  <p className=\"price\">{item.salePrice} EGP</p>\r\n\r\n                  <div className=\"quantity\">\r\n                    <button onClick={() => decreaseQty(item.id)}>\r\n                      <Minus size={16} />\r\n                    </button>\r\n                    <span>{item.quantity}</span>\r\n                    <button onClick={() => increaseQty(item.id)}>\r\n                      <Plus size={16} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                <button\r\n                  className=\"remove\"\r\n                  onClick={() => removeItem(item.id)}\r\n                >\r\n                  <Trash2 size={18} />\r\n                </button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Summary */}\r\n          <div className=\"summary\">\r\n            <h2>Order Summary</h2>\r\n\r\n            <div className=\"row\">\r\n              <span>Subtotal</span>\r\n              <span>{subTotal} EGP</span>\r\n            </div>\r\n\r\n            <button className=\"checkout-btn\">\r\n              <Link href='/checkout/confirm'>\r\n                Proceed to Checkout\r\n              </Link>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* TOAST NOTIFICATION */}\r\n      {toast.show && (\r\n        <div className={`fixed bottom-6 right-6 z-50 flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg ${toast.type === 'error' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'\r\n          }`}>\r\n          <span>{toast.message}</span>\r\n          <button onClick={() => setToast({ ...toast, show: false })} className=\"hover:opacity-80\">\r\n            <X size={18} />\r\n          </button>\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}