(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35893,e=>{e.v({"btn-primary":"checkout-module__r7yD0G__btn-primary","btn-secondary":"checkout-module__r7yD0G__btn-secondary","checkout-page":"checkout-module__r7yD0G__checkout-page","close-modal-btn":"checkout-module__r7yD0G__close-modal-btn","detailed-address-textarea":"checkout-module__r7yD0G__detailed-address-textarea","error-input":"checkout-module__r7yD0G__error-input","error-text":"checkout-module__r7yD0G__error-text",fadeIn:"checkout-module__r7yD0G__fadeIn","gov-dropdown":"checkout-module__r7yD0G__gov-dropdown","gov-option":"checkout-module__r7yD0G__gov-option","gov-search-input":"checkout-module__r7yD0G__gov-search-input","gov-select-wrapper":"checkout-module__r7yD0G__gov-select-wrapper","inputs-grid":"checkout-module__r7yD0G__inputs-grid","modal-actions":"checkout-module__r7yD0G__modal-actions","modal-content":"checkout-module__r7yD0G__modal-content","modal-header":"checkout-module__r7yD0G__modal-header","modal-overlay":"checkout-module__r7yD0G__modal-overlay","modal-title":"checkout-module__r7yD0G__modal-title","notification-error":"checkout-module__r7yD0G__notification-error","notification-success":"checkout-module__r7yD0G__notification-success","notification-toast":"checkout-module__r7yD0G__notification-toast","payment-box":"checkout-module__r7yD0G__payment-box","place-order-btn":"checkout-module__r7yD0G__place-order-btn",scaleUp:"checkout-module__r7yD0G__scaleUp",section:"checkout-module__r7yD0G__section","section-title":"checkout-module__r7yD0G__section-title",slideIn:"checkout-module__r7yD0G__slideIn","summary-item":"checkout-module__r7yD0G__summary-item","summary-total":"checkout-module__r7yD0G__summary-total",title:"checkout-module__r7yD0G__title"})},6456,e=>{"use strict";var t=e.i(43476),a=e.i(71645),l=e.i(16799),s=e.i(18566),r=e.i(3946),i=e.i(35893);let o=["Cairo","Giza","Alexandria","Dakahlia","Sharqia","Qalyubia","Kafr El Sheikh","Gharbia","Monufia","Beheira","Ismailia","Port Said","Suez","North Sinai","South Sinai","Damietta","New Valley","Matruh","Qena","Sohag","Aswan","Luxor","Red Sea","Beni Suef","Faiyum","Minya","Asyut"];function d(){let e=(0,s.useRouter)(),[d,n]=(0,a.useState)({fullName:"",email:"",phone:"",city:"",government:"",detailedAddress:""}),[c,u]=(0,a.useState)(0),[m,h]=(0,a.useState)("will be determined in the next step"),[p,f]=(0,a.useState)({}),[y,x]=(0,a.useState)(null),{user:_,loading:g,cartItems:j,refreshCart:v}=(0,r.useUser)(),[N,b]=(0,a.useState)([]),[k,D]=(0,a.useState)(0),[S,G]=(0,a.useState)(!0),[C,P]=(0,a.useState)(!1),[w,A]=(0,a.useState)(!1),E=(0,a.useRef)(null),[T,q]=(0,a.useState)(""),[$,O]=(0,a.useState)(!1),I=(0,a.useRef)(null),R=e=>{if(!e){u(0),h("");return}let t=e.toLowerCase().trim();"cairo"===t||"giza"===t?(u(50),h("")):"qalyubia"===t||"qalubia"===t?(u(75),h("")):""===t?(u(0),h("will be determined in the next step")):(u(0),h("Arrange via external courier"))},F=e=>{let{name:t,value:a}=e.target;n(e=>({...e,[t]:a}))},z=(e,t)=>{x({type:e,message:t}),setTimeout(()=>x(null),4e3)},B=async()=>{let t;if(t={},d.fullName.trim()||(t.fullName="Full Name is required"),d.email.trim()||(t.email="Email is required"),d.phone.trim()||(t.phone="Phone Number is required"),d.city.trim()||(t.city="City is required"),d.government.trim()||(t.government="Governorate is required"),d.detailedAddress.trim()||(t.detailedAddress="Address is required"),f(t),0!==Object.keys(t).length)return void z("error","Please fill in all details correctly.");P(!0);try{if(0===j.length){z("error","Your cart is empty."),P(!1);return}let t=j.reduce((e,t)=>e+t.salePrice*t.quantity,0)+c,a={name:d.fullName,email:d.email,phone:d.phone,items:j.map(e=>({productId:e.productId,quantity:e.quantity,color:e.color,size:e.size})),totalPrice:t,paymentMethod:"Cash on Delivery",paymentStatus:"unpaid",orderStatus:"pending",address:`${d.detailedAddress}, ${d.city}, ${d.government}`},s=await fetch(l.END_POINT.ORDERS,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)}),r=await s.json();if(s.ok&&r.successful){let t=E.current;if(t&&(t.phone!==d.phone||t.address!==d.detailedAddress||t.name!==d.fullName)){let e={name:d.fullName,phone:d.phone,address:d.detailedAddress};try{(await fetch(`${l.END_POINT.USERS}/profile`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})).ok||console.warn("Profile update failed, but order was placed successfully")}catch(e){console.warn("Profile update error:",e)}}await fetch(l.END_POINT.CART(""),{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"}),v(),A(!1),z("success","Order placed successfully! Redirecting..."),setTimeout(()=>{e.push("/")},1500)}else z("error",r.message||"Failed to place order. Please try again."),P(!1)}catch(e){console.error("Error placing order:",e),z("error","An error occurred. Please try again."),P(!1)}},L=o.filter(e=>e.toLowerCase().includes(T.toLowerCase()));(0,a.useEffect)(()=>{if(!g&&!_)return void e.replace("/auth/login");if(_){let e=_.government||"";n(t=>({...t,fullName:_.name||"",email:_.email||"",phone:_.phone||"",government:e,city:_.city||"",detailedAddress:_.address||""})),E.current=_,q(e),R(e),G(!1)}},[_,g,e]),(0,a.useEffect)(()=>{j&&(b(j),D(j.reduce((e,t)=>e+t.salePrice*t.quantity,0)))},[j]),(0,a.useEffect)(()=>{let e=e=>{I.current&&!I.current.contains(e.target)&&O(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let U=m?k:k+c;return(0,t.jsxs)("div",{className:i.default["checkout-page"],children:[(0,t.jsx)("h1",{className:i.default.title,children:"Checkout"}),y&&(0,t.jsx)("div",{className:`${i.default["notification-toast"]} ${"success"===y.type?i.default["notification-success"]:i.default["notification-error"]}`,children:y.message}),(0,t.jsxs)("section",{className:i.default.section,children:[(0,t.jsx)("h2",{className:i.default["section-title"],children:"Contact Info"}),(0,t.jsx)("div",{className:i.default["inputs-grid"],children:(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:d.phone,onChange:F,className:p.phone?i.default["error-input"]:""}),p.phone&&(0,t.jsx)("small",{className:i.default["error-text"],children:p.phone})]})})]}),(d.government||d.city||d.detailedAddress)&&(0,t.jsxs)("section",{className:i.default.section,children:[(0,t.jsx)("h2",{className:i.default["section-title"],children:"Shipping To"}),(0,t.jsxs)("div",{style:{padding:"10px 0",fontSize:"16px",color:"#555"},children:[(0,t.jsxs)("p",{style:{margin:"0 0 5px"},children:[(0,t.jsx)("strong",{children:d.government}),d.city?`, ${d.city}`:""]}),(0,t.jsx)("p",{style:{margin:0},children:d.detailedAddress})]})]}),(0,t.jsxs)("section",{className:i.default.section,children:[(0,t.jsx)("h2",{className:i.default["section-title"],children:"Payment Method"}),(0,t.jsx)("div",{className:i.default["payment-box"],children:(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"radio",name:"payment",defaultChecked:!0,readOnly:!0}),"Cash on Delivery"]})})]}),(0,t.jsxs)("section",{className:`${i.default.section} ${i.default.summary}`,children:[(0,t.jsx)("h2",{className:i.default["section-title"],children:"Order Summary"}),(0,t.jsx)("div",{style:{marginBottom:"20px",borderBottom:"1px solid #f0f0f0",paddingBottom:"10px"},children:N.map(e=>(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"15px",color:"#555"},children:[(0,t.jsxs)("span",{children:[e.name," x ",e.quantity]}),(0,t.jsxs)("span",{children:[(e.salePrice*e.quantity).toFixed(2)," EGP"]})]},e.id))}),(0,t.jsxs)("div",{className:i.default["summary-item"],children:[(0,t.jsx)("span",{children:"Subtotal"}),(0,t.jsxs)("span",{children:[k.toFixed(2)," EGP"]})]}),(0,t.jsxs)("div",{className:i.default["summary-item"],children:[(0,t.jsx)("span",{children:"Shipping"}),(0,t.jsx)("span",{style:{fontSize:m?"14px":"18px",color:m?"#e67e22":"inherit"},children:m||`${c.toFixed(2)} EGY`})]}),(0,t.jsxs)("div",{className:i.default["summary-total"],children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsxs)("span",{children:[U.toFixed(2)," EGP"]})]})]}),(0,t.jsx)("button",{className:i.default["place-order-btn"],onClick:e=>{e.preventDefault(),(d.phone.trim()?(f({}),0):(f({phone:"Phone Number is required"}),1))||A(!0)},disabled:S,children:S?"Loading...":"Checkout"}),w&&(0,t.jsx)("div",{className:i.default["modal-overlay"],children:(0,t.jsxs)("div",{className:i.default["modal-content"],children:[(0,t.jsxs)("div",{className:i.default["modal-header"],children:[(0,t.jsx)("h3",{className:i.default["modal-title"],children:"Confirm Your Details"}),(0,t.jsx)("button",{className:i.default["close-modal-btn"],onClick:()=>A(!1),children:"Ã—"})]}),(0,t.jsx)("p",{style:{marginBottom:"20px",color:"#666"},children:"Please review your information before placing the order."}),(0,t.jsxs)("div",{className:i.default["inputs-grid"],style:{gap:"15px"},children:[(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"text",name:"fullName",placeholder:"Full Name",value:d.fullName,onChange:F,className:p.fullName?i.default["error-input"]:""}),p.fullName&&(0,t.jsx)("small",{className:i.default["error-text"],children:p.fullName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"email",name:"email",placeholder:"Email",value:d.email,className:p.email?i.default["error-input"]:"",disabled:!0}),p.email&&(0,t.jsx)("small",{className:i.default["error-text"],children:p.email})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:d.phone,onChange:F,className:p.phone?i.default["error-input"]:""}),p.phone&&(0,t.jsx)("small",{className:i.default["error-text"],children:p.phone})]}),(0,t.jsxs)("div",{className:i.default["gov-select-wrapper"],ref:I,children:[(0,t.jsx)("input",{type:"text",name:"government",placeholder:"Government",value:T,onChange:e=>{let t=e.target.value;q(t),O(!0),t&&o.includes(t)?(n(e=>({...e,government:t})),R(t)):t||(n(e=>({...e,government:""})),R(""))},onFocus:()=>O(!0),className:`${i.default["gov-search-input"]} ${p.government?i.default["error-input"]:""}`}),p.government&&(0,t.jsx)("small",{className:i.default["error-text"],children:p.government}),$&&L.length>0&&(0,t.jsx)("div",{className:i.default["gov-dropdown"],children:L.map(e=>(0,t.jsx)("div",{className:i.default["gov-option"],onClick:()=>{n(t=>({...t,government:e})),q(e),O(!1),R(e)},children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"text",name:"city",placeholder:"City",value:d.city,onChange:F,className:p.city?i.default["error-input"]:""}),p.city&&(0,t.jsx)("small",{className:i.default["error-text"],children:p.city})]}),(0,t.jsx)("textarea",{name:"detailedAddress",placeholder:"Detailed Address",value:d.detailedAddress,onChange:F,className:`${i.default["detailed-address-textarea"]} ${p.detailedAddress?i.default["error-input"]:""}`,style:{minHeight:"80px"}}),p.detailedAddress&&(0,t.jsx)("small",{className:i.default["error-text"],children:p.detailedAddress})]}),(0,t.jsxs)("div",{className:i.default.summary,style:{marginTop:"20px",background:"#fafafa",padding:"15px",borderRadius:"12px"},children:[(0,t.jsxs)("div",{className:`${i.default["summary-item"]} flex flex-col`,style:{fontSize:"16px"},children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Shipping:"}),(0,t.jsxs)("strong",{children:[c.toFixed(2)," EGP"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Total with Shipping:"}),(0,t.jsxs)("strong",{children:[U.toFixed(2)," EGP"]})]})]}),m&&(0,t.jsx)("small",{style:{color:"#e67e22"},children:m})]}),(0,t.jsxs)("div",{className:i.default["modal-actions"],children:[(0,t.jsx)("button",{className:i.default["btn-secondary"],onClick:()=>A(!1),children:"Cancel"}),(0,t.jsx)("button",{className:i.default["btn-primary"],onClick:B,disabled:C,children:C?"Confirming...":"Save & Confirm Order"})]})]})})]})}e.s(["default",()=>d])}]);